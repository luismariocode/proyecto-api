<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/tailwind.css">
    <link rel="import" href="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/0.9.0rc1/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        .resultados-ocultos {
            display: none;
            /* Oculta todos los resultados inicialmente */
        }

        .resultado #resultado1 {
            display: block;
        }
    </style>

    <title>Resultados</title>
</head>

<body>

    <header class="mb-20">

        <nav class="bg-green-600">
          <div class="header-titulo   bg-green-600">
            <h3>IMSS</h3>
          </div>
        </nav>
    
    
    
        <div class="header-img-container">
          <div class="header-img-container--img  ">
    
            <img src="assets/logo-sntte.svg" alt="logo de la compañia">
            <h1 >Proyección aproximada de tu jubilación</h1>
          </div>
    
        </div>
      </header>

    <div class="container" id="container">

        <!-- 
            <div class="tabla-titulo">
                <div></div>
                <button id="btnExportar"></button>
            </div> -->

            <div class="bg-teal-100 border-t-4 border-green-900 rounded-b text-teal-900 px-4 py-3 shadow-md msj-final p-5 mt-5 "
            role="alert">
            <div class="flex">
              <div class="py-1 "><svg class="fill-current h-10 w-10 text-green-900 mr-4"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                  <path
                    d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z" />
                </svg></div>
              <div>
  
                <p class="text-sm text-green-900">Recuerda que este es un simulador por lo cual los resultados pueden
                  variar significativamente, pues dependen de que se cumplan los supuestos biométricos y financieros
                  utilizados</p>
                  <br>
                  <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Atque deserunt perferendis, delectus dignissimos in natus necessitatibus explicabo iste assumenda! Sed, dicta ea voluptatibus ab labore architecto in sit harum consequatur!</p>
                  <br>
                  <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam alias veritatis at delectus? Saepe, iusto. Consequatur sunt vel error quae placeat corporis voluptatibus, velit qui soluta repudiandae fuga deleniti mollitia.</p>
                  <br>
                  <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. At provident voluptatem minus esse perspiciatis illum officia voluptates, asperiores unde eum! Modi nobis omnis natus architecto sunt quibusdam distinctio aut nihil.</p>
              </div>
            </div>
          </div>
  


        <div class="total-resultados">
            <!-- <div class="msj-result-pension">
                <p>Tu pension a los </p> 
    
            </div> -->
            <p>Tu pension a los</p>
            <p>Pension</p>
            <p>Porcentaje al ultimo salrio de cotizacion</p>
            <p>-</p>
            <p>$</p>
            <p>$</p>
        </div>


        <div class="nav-bar" id="nav-bar">
            <button onclick="mostrarResultado('resultado1')">TOTAL </button>
            <button onclick="mostrarResultado('resultado2')">IMSS </button>
            <button onclick="mostrarResultado('resultado3')">CONVENIO LABORAL SNTSS (15%) </button>
        </div>

        <!-- 
        <table id="resultados-t">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Edad</th>
                    <th>Correo electrónico</th>
                </tr>
            </thead>
            <tbody>
                Las filas se agregarán aquí dinámicamente con JavaScript
             </tbody>
        </table> -->


        <div id="resultado1" class="resultado">
            <table id="resultados-t">
                <thead>
                    <tr>
                        <th>Año</th>
                        <th>Edad</th>
                        <!-- <th>Antiguedad</th> -->
                        <th>Sueldo de Cotizacion</th>
                        <th>Saldo Total</th>
                        <th>Pension del IMSS</th>
                        <th>Pension del Convenio Laboral</th>
                        <!-- <th>Pension Garantizada IMSS</th> -->
                        <th>Pension Total</th>
                        <th>Porcentaje del Salario de Cotizacion</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>



        <div id="resultado2" class="resultado resultados-ocultos">
            <table id="resultados-imss">
                <thead>
                    <tr>
                        <th>Año</th>
                        <th>Edad</th>
                        <!-- <th>Antiguedad</th> -->
                        <th>Sueldo de Cotizacion</th>
                        <th>Saldo de la Cuenta Individual</th>
                        <th>Renta Vitalicia IMSS</th>
                        <th>Pension Garantizada IMSS</th>
                        <th>Pension IMSS</th>
                        <th>Porcentaje del Salario de Cotizacion</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>



        <div id="resultado3" class="resultado resultados-ocultos">
            <table id="resultados-rjp">
                <thead>
                    <tr>
                        <th>Año</th>
                        <th>Edad</th>
                        <!-- <th>Antiguedad</th> -->
                        <th>Sueldo de Cotizacion </th>
                        <th>Saldo de la Subcuenta Adiccional</th>
                        <th>Monto de Pension</th>

                        <th>Porcentaje del Salario de Cotizacion</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>



        <div class="boton">
            <button onclick="generarPDF()">Descargar<span></span></button>
        </div>

    </div>


    <script>

        const url = "http://192.168.1.235:8574/sntssrv.dll/api/rest/tsm/prueba";
        // const encoded = encodeURI(url);

        axios.get(url)
            .then(response => {
                const data = response.data; // JSON recibido desde la API
                const headers = response.headers;
                console.log("header", headers);


                var jsonResultados = JSON.stringify(data);


                const datosTabulados = jsonResultados.slice(43, -1);
                // console.log("esta es la informacion que esta procesada",data);
                console.log(datosTabulados);



                var resultados = JSON.parse(datosTabulados);

                var tabla = document.getElementById('resultados-t');
                // console.log(resultados);
                // Obtener la referencia a la tabla
                for (var clave in resultados) {

                    if (resultados.hasOwnProperty(clave)) {
                        var resultado = resultados[clave];
                        var fila = document.createElement('tr');

                        var celdaNombre = document.createElement('td');
                        celdaNombre.textContent = resultado.Anio;
                        fila.appendChild(celdaNombre);


                        var celdaNombre = document.createElement('td');
                        celdaNombre.textContent = resultado.Edad;


                        if (resultado.Edad == 65) {
                            celdaNombre.style.background = "green";
                        }

                        fila.appendChild(celdaNombre);


                        var celdaEmail = document.createElement('td');
                        celdaEmail.textContent = resultado.Sueldo;
                        fila.appendChild(celdaEmail);

                        var celdaEdad = document.createElement('td');
                        celdaEdad.textContent = resultado.SaldoTotal;
                        fila.appendChild(celdaEdad);

                        var celdaEmail = document.createElement('td');
                        celdaEmail.textContent = resultado.RtaVitIMSS;
                        fila.appendChild(celdaEmail);

                        var celdaEdad = document.createElement('td');
                        celdaEdad.textContent = resultado.RtaVitRJP;
                        fila.appendChild(celdaEdad);

                        var celdaEmail = document.createElement('td');
                        celdaEmail.textContent = resultado.Pension;
                        fila.appendChild(celdaEmail);

                        var celdaEmail = document.createElement('td');
                        celdaEmail.textContent = resultado.pjeTotal;
                        fila.appendChild(celdaEmail);

                        tabla.appendChild(fila);
                    }
                }

                var tabla_dos = document.getElementById('resultados-imss');
                // console.log(resultados);
                // Obtener la referencia a la tabla
                for (var clave in resultados) {

                    if (resultados.hasOwnProperty(clave)) {
                        var resultado = resultados[clave];
                        var fila = document.createElement('tr');

                        var celdaNombre = document.createElement('td');
                        celdaNombre.textContent = resultado.Anio;
                        fila.appendChild(celdaNombre);

                        var celdaEdad = document.createElement('td');
                        celdaEdad.textContent = resultado.Edad;
                        fila.appendChild(celdaEdad);

                        if (resultado.Edad == 65) {
                            celdaEdad.style.background = "green";
                        }

                        var celdaEdad = document.createElement('td');
                        celdaEdad.textContent = resultado.Sueldo;
                        fila.appendChild(celdaEdad);

                        var celdaEmail = document.createElement('td');
                        celdaEmail.textContent = resultado.SaldoIMSS;
                        fila.appendChild(celdaEmail);

                        var celdaEdad = document.createElement('td');
                        celdaEdad.textContent = resultado.RtaVitIMSS;
                        fila.appendChild(celdaEdad);

                        var celdaEmail = document.createElement('td');
                        celdaEmail.textContent = resultado.PenGarIMSS;
                        fila.appendChild(celdaEmail);

                        var celdaEmail = document.createElement('td');
                        celdaEmail.textContent = resultado.PensionIMSS;
                        fila.appendChild(celdaEmail);

                        var celdaEmail = document.createElement('td');
                        celdaEmail.textContent = resultado.pjeIMSS;
                        fila.appendChild(celdaEmail);




                        tabla_dos.appendChild(fila);
                    }
                }



                //tabular los datos del RJP

                //******************************
                var tabla_dos = document.getElementById('resultados-rjp');
                // console.log(resultados);
                // Obtener la referencia a la tabla
                for (var clave in resultados) {

                    if (resultados.hasOwnProperty(clave)) {
                        var resultado = resultados[clave];
                        var fila = document.createElement('tr');

                        var celdaNombre = document.createElement('td');
                        celdaNombre.textContent = resultado.Anio;
                        fila.appendChild(celdaNombre);

                        var celdaEdad = document.createElement('td');
                        celdaEdad.textContent = resultado.Edad;
                        fila.appendChild(celdaEdad);

                        if (resultado.Edad == 65) {
                            celdaEdad.style.background = "yellow";
                        }


                        var celdaEdad = document.createElement('td');
                        celdaEdad.textContent = resultado.Sueldo;
                        fila.appendChild(celdaEdad);

                        var celdaEmail = document.createElement('td');
                        celdaEmail.textContent = resultado.SaldoRJP;
                        fila.appendChild(celdaEmail);

                        var celdaEdad = document.createElement('td');
                        celdaEdad.textContent = resultado.RtaVitRJP;
                        fila.appendChild(celdaEdad);



                        var celdaEmail = document.createElement('td');
                        celdaEmail.textContent = resultado.pjeRJP;
                        fila.appendChild(celdaEmail);




                        tabla_dos.appendChild(fila);
                    }
                }


            })


            .catch(error => {

                console.error('Error en la solicitud:', error);

            });




        function generarPDF() {
            // Obtener el contenido del div
            var contenidoDiv = document.getElementById('container').innerHTML;

            // Ocultar los botones dentro del div
            var botones = document.getElementById('container').querySelectorAll('button');
            for (var i = 0; i < botones.length; i++) {
                botones[i].style.display = 'none';
            }

            // Crear un iframe oculto
            var iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

            // Agregar el contenido del div al iframe
            iframeDoc.body.innerHTML = contenidoDiv;

            // Esperar a que el contenido se cargue completamente
            setTimeout(function () {
                // Imprimir el iframe
                iframe.contentWindow.print();

                // Restaurar la visualización de los botones
                for (var i = 0; i < botones.length; i++) {
                    botones[i].style.display = 'block';
                }

                // Eliminar el iframe
                document.body.removeChild(iframe);
            }, 1000);
        }




    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

    <script src="js/script.js"></script>
</body>

</html>